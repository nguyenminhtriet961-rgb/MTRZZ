<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - File Download Hub</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <link rel="stylesheet" href="main.css">
    <style>
        .admin-container { max-width: 1400px; margin: 0 auto; padding: 20px; }
        .admin-header { background: var(--card-bg); border: 1px solid var(--border-color); border-radius: 12px; padding: 25px; margin-bottom: 30px; display: flex; justify-content: space-between; align-items: center; }
        .admin-section { background: var(--card-bg); border: 1px solid var(--border-color); border-radius: 12px; padding: 25px; margin-bottom: 30px; }
        .form-row { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px; margin-bottom: 15px; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { padding: 12px; text-align: left; border-bottom: 1px solid var(--border-color); vertical-align: middle; }
        th { color: var(--primary-color); }
        .btn-delete { background: var(--red-out); color: white; border: none; padding: 5px 10px; border-radius: 5px; cursor: pointer; }
        
        /* Style cho ·∫£nh thumb trong b·∫£ng admin */
        .thumb-img {
            width: 50px;
            height: 50px;
            object-fit: cover;
            border-radius: 5px;
            border: 1px solid var(--border-color);
        }
        
        /* Responsive improvements for admin.html */
        @media (max-width: 768px) {
            .admin-container { padding: 10px; }
            .admin-header { flex-direction: column; gap: 15px; padding: 20px; }
            .admin-header h1 { font-size: 1.5rem; }
            .admin-section { padding: 20px; }
            .form-row { grid-template-columns: 1fr; gap: 10px; }
            table { font-size: 0.9rem; }
            th, td { padding: 8px; }
            .thumb-img { width: 40px; height: 40px; }
        }
        @media (max-width: 480px) {
            .admin-header h1 { font-size: 1.2rem; }
            .admin-section { padding: 15px; }
            table { font-size: 0.8rem; }
            th, td { padding: 6px; }
            .btn-delete { padding: 3px 6px; font-size: 0.8rem; }
        }
    </style>
</head>
<body data-theme="dark">
    <div class="admin-container">
        <div class="admin-header">
            <h1 style="color: var(--primary-color);">Qu·∫£n l√Ω File Download Hub</h1>
            <div>
                <button class="btn-secondary" onclick="logout()" id="logoutBtn" style="display: none; margin-right: 10px;">ƒêƒÉng xu·∫•t</button>
                <button class="btn-primary" onclick="window.location.href='index.html'">V·ªÅ trang ch·ªß</button>
            </div>
        </div>

        <div class="admin-section">
            <h3 style="color: var(--primary-color); margin-bottom: 20px;">ƒêƒÉng nh·∫≠p Admin</h3>
            <form id="adminLoginForm" onsubmit="handleAdminLogin(event)">
                <div class="form-row">
                    <div class="form-group">
                        <label>T√™n ƒëƒÉng nh·∫≠p:</label>
                        <input type="text" id="adminUsername" required placeholder="Admin username">
                    </div>
                    <div class="form-group">
                        <label>M·∫≠t kh·∫©u:</label>
                        <input type="password" id="adminPassword" required placeholder="Admin password">
                    </div>
                </div>
                <button type="submit" class="btn-primary" style="width: 100%;">ƒêƒÉng nh·∫≠p</button>
            </form>
        </div>

        <div id="adminContent" style="display: none;">
            <!-- Dashboard Statistics -->
            <div class="admin-section">
                <h3 style="color: var(--primary-color); margin-bottom: 20px;">üìä Th·ªëng k√™ Dashboard</h3>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 20px;">
                    <div style="background: linear-gradient(135deg, var(--primary-color), var(--secondary-color)); padding: 20px; border-radius: 12px; text-align: center; color: white;">
                        <h4 style="margin: 0; font-size: 2rem;" id="totalFiles">0</h4>
                        <p style="margin: 5px 0 0 0;">T·ªïng Files</p>
                    </div>
                    <div style="background: linear-gradient(135deg, #667eea, #764ba2); padding: 20px; border-radius: 12px; text-align: center; color: white;">
                        <h4 style="margin: 0; font-size: 2rem;" id="totalDownloads">0</h4>
                        <p style="margin: 5px 0 0 0;">T·ªïng L∆∞·ª£t T·∫£i</p>
                    </div>
                    <div style="background: linear-gradient(135deg, #f093fb, #f5576c); padding: 20px; border-radius: 12px; text-align: center; color: white;">
                        <h4 style="margin: 0; font-size: 2rem;" id="totalViews">0</h4>
                        <p style="margin: 5px 0 0 0;">T·ªïng L∆∞·ª£t Xem</p>
                    </div>
                    <div style="background: linear-gradient(135deg, #4facfe, #00f2fe); padding: 20px; border-radius: 12px; text-align: center; color: white;">
                        <h4 style="margin: 0; font-size: 2rem;" id="avgSize">0 MB</h4>
                        <p style="margin: 5px 0 0 0;">K√≠ch th∆∞·ªõc TB</p>
                    </div>
                </div>
                
                <!-- Category Breakdown -->
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px;">
                    <div style="background: var(--card-bg); border: 1px solid var(--border-color); padding: 15px; border-radius: 8px;">
                        <h5 style="color: var(--primary-color); margin: 0 0 10px 0;">üéÆ Game PC</h5>
                        <p style="margin: 5px 0;">S·ªë l∆∞·ª£ng: <span id="gamePcCount">0</span></p>
                        <p style="margin: 5px 0;">L∆∞·ª£t t·∫£i: <span id="gamePcDownloads">0</span></p>
                    </div>
                    <div style="background: var(--card-bg); border: 1px solid var(--border-color); padding: 15px; border-radius: 8px;">
                        <h5 style="color: var(--primary-color); margin: 0 0 10px 0;">üíª Software</h5>
                        <p style="margin: 5px 0;">S·ªë l∆∞·ª£ng: <span id="softwareCount">0</span></p>
                        <p style="margin: 5px 0;">L∆∞·ª£t t·∫£i: <span id="softwareDownloads">0</span></p>
                    </div>
                    <div style="background: var(--card-bg); border: 1px solid var(--border-color); padding: 15px; border-radius: 8px;">
                        <h5 style="color: var(--primary-color); margin: 0 0 10px 0;">üìö Documents</h5>
                        <p style="margin: 5px 0;">S·ªë l∆∞·ª£ng: <span id="documentsCount">0</span></p>
                        <p style="margin: 5px 0;">L∆∞·ª£t t·∫£i: <span id="documentsDownloads">0</span></p>
                    </div>
                    <div style="background: var(--card-bg); border: 1px solid var(--border-color); padding: 15px; border-radius: 8px;">
                        <h5 style="color: var(--primary-color); margin: 0 0 10px 0;">üîß Tools</h5>
                        <p style="margin: 5px 0;">S·ªë l∆∞·ª£ng: <span id="toolsCount">0</span></p>
                        <p style="margin: 5px 0;">L∆∞·ª£t t·∫£i: <span id="toolsDownloads">0</span></p>
                    </div>
                </div>
            </div>

            <!-- Quick Actions -->
            <div class="admin-section">
                <h3 style="color: var(--primary-color); margin-bottom: 20px;">‚ö° H√†nh ƒë·ªông nhanh</h3>
                <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                    <button class="btn-primary" onclick="exportData()">üì§ Xu·∫•t d·ªØ li·ªáu</button>
                    <button class="btn-secondary" onclick="importData()">üì• Nh·∫≠p d·ªØ li·ªáu</button>
                    <button class="btn-secondary" onclick="clearAllData()">üóëÔ∏è X√≥a t·∫•t c·∫£</button>
                    <button class="btn-secondary" onclick="resetStats()">üîÑ Reset th·ªëng k√™</button>
                    <button class="btn-secondary" onclick="backupData()">üíæ Backup</button>
                </div>
            </div>

            <div class="admin-section">
                <h3 style="color: var(--primary-color); margin-bottom: 20px;">Th√™m file m·ªõi</h3>
                <form id="addFileForm" onsubmit="handleAddFile(event)">
                    <div class="form-row">
                        <div class="form-group">
                            <label>T√™n file:</label>
                            <input type="text" id="fileName" required placeholder="V√≠ d·ª•: Photoshop 2024">
                        </div>
                        <div class="form-group">
                            <label>Link ·∫£nh:</label>
                            <div style="display: flex; gap: 10px; margin-bottom: 10px;">
                                <input type="text" id="fileImage" placeholder="https://example.com/image.jpg" style="flex: 1;">
                                <button type="button" class="btn-secondary" onclick="document.getElementById('imageUpload').click()" style="white-space: nowrap;">
                                    <i class="fa-solid fa-upload"></i> Upload
                                </button>
                            </div>
                            <input type="file" id="imageUpload" accept="image/*" style="display: none;" onchange="handleImageUpload(event)">
                            <small style="color: var(--text-secondary); font-size: 0.8rem;">Copy link ·∫£nh t·ª´ Facebook/Imgur ho·∫∑c upload ·∫£nh t·ª´ thi·∫øt b·ªã</small>
                            
                            <!-- Image Preview -->
                            <div id="imagePreview" style="margin-top: 10px; display: none;">
                                <img id="previewImg" src="" alt="Preview" style="max-width: 200px; max-height: 150px; border-radius: 8px; border: 1px solid var(--border-color);">
                                <button type="button" onclick="removeImagePreview()" class="btn-delete" style="margin-top: 5px; padding: 5px 10px;">
                                    <i class="fa-solid fa-times"></i> X√≥a
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label>K√≠ch th∆∞·ªõc:</label>
                            <input type="text" id="fileSize" required placeholder="V√≠ d·ª•: 4.1 GB">
                        </div>
                        <div class="form-group">
                            <label>S·ªë l∆∞·ª£t t·∫£i (ban ƒë·∫ßu):</label>
                            <input type="number" id="fileDownloads" value="0">
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label>S·ªë l∆∞·ª£t xem (ban ƒë·∫ßu):</label>
                            <input type="number" id="fileViewCount" value="0">
                        </div>
                        <div class="form-group">
                            <label>Danh m·ª•c:</label>
                            <select id="fileCategory" required>
                                <option value="game-pc">Game - PC</option>
                                <option value="game-mobile">Game - Mobile</option>
                                <option value="game-mod">Game - Mods & Tools</option>
                                <option value="soft-office">Software - Office</option>
                                <option value="soft-design">Software - Design</option>
                                <option value="soft-dev">Software - Development</option>
                                <option value="doc-education">Documents - Education</option>
                                <option value="doc-ebook">Documents - Ebook</option>
                                <option value="tools-system">Tools - System</option>
                                <option value="tools-security">Tools - Security</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-group" style="margin-bottom: 15px;">
                        <label style="color: var(--secondary-color); font-weight: bold;">Link t·∫£i:</label>
                        <input type="text" id="fileLink" required placeholder="https://example.com/file.zip" style="border-color: var(--secondary-color);">
                    </div>

                    <div class="form-group" style="margin-bottom: 15px;">
                        <label>M√¥ t·∫£ ng·∫Øn:</label>
                        <textarea id="fileDesc" rows="2" placeholder="M√¥ t·∫£ file..."></textarea>
                    </div>
                    <button type="submit" class="btn-primary" style="width: 100%;">L∆∞u file</button>
                </form>
            </div>

            <div class="admin-section">
                <h3>Danh s√°ch file</h3>
                <table>
                    <thead>
                        <tr>
                            <th>·∫¢nh</th>
                            <th>T√™n file</th>
                            <th>Danh m·ª•c</th>
                            <th>K√≠ch th∆∞·ªõc</th>
                            <th>L∆∞·ª£t xem</th>
                            <th>L∆∞·ª£t t·∫£i</th>
                            <th>Link t·∫£i</th>
                            <th>Thao t√°c</th>
                        </tr>
                    </thead>
                    <tbody id="fileTableBody"></tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Edit Modal -->
    <div id="editModal" class="modal">
        <div class="modal-content" style="max-width: 800px; width: 90%;">
            <div class="modal-header">
                <h3><i class="fa-solid fa-edit"></i> Ch·ªânh s·ª≠a file</h3>
                <span class="close-modal" onclick="closeEditModal()">&times;</span>
            </div>
            <div class="modal-body">
                <form id="editFileForm" onsubmit="handleEditFile(event)">
                    <input type="hidden" id="editFileId">
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>T√™n file:</label>
                            <input type="text" id="editFileName" required>
                        </div>
                        <div class="form-group">
                            <label>Link ·∫£nh:</label>
                            <div style="display: flex; gap: 10px; margin-bottom: 10px;">
                                <input type="text" id="editFileImage" style="flex: 1;">
                                <button type="button" class="btn-secondary" onclick="document.getElementById('editImageUpload').click()">
                                    <i class="fa-solid fa-upload"></i> Upload
                                </button>
                            </div>
                            <input type="file" id="editImageUpload" accept="image/*" style="display: none;" onchange="handleEditImageUpload(event)">
                            
                            <!-- Edit Image Preview -->
                            <div id="editImagePreview" style="margin-top: 10px; display: none;">
                                <img id="editPreviewImg" src="" alt="Preview" style="max-width: 200px; max-height: 150px; border-radius: 8px; border: 1px solid var(--border-color);">
                                <button type="button" onclick="removeEditImagePreview()" class="btn-delete" style="margin-top: 5px; padding: 5px 10px;">
                                    <i class="fa-solid fa-times"></i> X√≥a
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label>K√≠ch th∆∞·ªõc:</label>
                            <input type="text" id="editFileSize" required>
                        </div>
                        <div class="form-group">
                            <label>S·ªë l∆∞·ª£t t·∫£i:</label>
                            <input type="number" id="editFileDownloads" value="0">
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label>S·ªë l∆∞·ª£t xem:</label>
                            <input type="number" id="editFileViewCount" value="0">
                        </div>
                        <div class="form-group">
                            <label>Danh m·ª•c:</label>
                            <select id="editFileCategory" required>
                                <option value="game-pc">Game - PC</option>
                                <option value="game-mobile">Game - Mobile</option>
                                <option value="game-mod">Game - Mods & Tools</option>
                                <option value="soft-office">Software - Office</option>
                                <option value="soft-design">Software - Design</option>
                                <option value="soft-dev">Software - Development</option>
                                <option value="doc-education">Documents - Education</option>
                                <option value="doc-ebook">Documents - Ebook</option>
                                <option value="tools-system">Tools - System</option>
                                <option value="tools-security">Tools - Security</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-group" style="margin-bottom: 15px;">
                        <label style="color: var(--secondary-color); font-weight: bold;">Link t·∫£i:</label>
                        <input type="text" id="editFileLink" required style="border-color: var(--secondary-color);">
                    </div>

                    <div class="form-group" style="margin-bottom: 15px;">
                        <label>M√¥ t·∫£ ng·∫Øn:</label>
                        <textarea id="editFileDesc" rows="2"></textarea>
                    </div>
                    
                    <div style="display: flex; gap: 10px;">
                        <button type="submit" class="btn-primary" style="flex: 1;">
                            <i class="fa-solid fa-save"></i> L∆∞u thay ƒë·ªïi
                        </button>
                        <button type="button" class="btn-secondary" onclick="closeEditModal()" style="flex: 1;">
                            <i class="fa-solid fa-times"></i> H·ªßy
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <div id="alertBox" class="alert-box"></div>

    <script>
        const DB_FILES = 'download_files';
        const ADMIN_CREDENTIALS = {
            username: 'admin',
            password: 'admin123'
        };

        // Check if already logged in
        function checkAdminAuth() {
            const isLoggedIn = sessionStorage.getItem('adminLoggedIn') === 'true';
            if (isLoggedIn) {
                showAdminContent();
            } else {
                hideAdminContent();
            }
        }

        function handleAdminLogin(e) {
            e.preventDefault();
            const username = document.getElementById('adminUsername').value;
            const password = document.getElementById('adminPassword').value;

            if (username === ADMIN_CREDENTIALS.username && password === ADMIN_CREDENTIALS.password) {
                sessionStorage.setItem('adminLoggedIn', 'true');
                showToast('ƒêƒÉng nh·∫≠p th√†nh c√¥ng!', 'success');
                showAdminContent();
                e.target.reset();
            } else {
                showToast('Sai t√™n ƒëƒÉng nh·∫≠p ho·∫∑c m·∫≠t kh·∫©u!', 'error');
            }
        }

        function showAdminContent() {
            document.getElementById('adminContent').style.display = 'block';
            document.querySelector('#adminLoginForm').parentElement.style.display = 'none';
            document.getElementById('logoutBtn').style.display = 'inline-block';
            updateDashboard();
            renderTable();
        }

        function hideAdminContent() {
            document.getElementById('adminContent').style.display = 'none';
            document.querySelector('#adminLoginForm').parentElement.style.display = 'block';
            document.getElementById('logoutBtn').style.display = 'none';
        }

        function logout() {
            sessionStorage.removeItem('adminLoggedIn');
            hideAdminContent();
            showToast('ƒê√£ ƒëƒÉng xu·∫•t!', 'info');
        }

        function handleAddFile(e) {
            e.preventDefault();
            const files = JSON.parse(localStorage.getItem(DB_FILES)) || [];
            
            const newFile = {
                id: 'FILE' + Date.now(),
                name: document.getElementById('fileName').value,
                category: document.getElementById('fileCategory').value,
                size: document.getElementById('fileSize').value,
                downloads: parseInt(document.getElementById('fileDownloads').value) || 0,
                viewCount: parseInt(document.getElementById('fileViewCount').value) || 0,
                link: document.getElementById('fileLink').value,
                desc: document.getElementById('fileDesc').value,
                image: document.getElementById('fileImage').value || 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzAwIiBoZWlnaHQ9IjIwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMzAwIiBoZWlnaHQ9IjIwMCIgZmlsbD0iIzZDNzVEIi8+PHRleHQgeD0iNTAlIiB5PSI1MCUiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSIxOCIgZmlsbD0id2hpdGUiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGR5PSIuM2VtIj5ObyBJbWFnZTwvdGV4dD48L3N2Zz4='
            };

            files.push(newFile);
            localStorage.setItem(DB_FILES, JSON.stringify(files));
            
            showToast('ƒê√£ l∆∞u file! D·ªØ li·ªáu s·∫Ω t·ª± ƒë·ªông ƒë·ªìng b·ªô v·ªõi trang ch·ªß.', 'success');
            e.target.reset();
            removeImagePreview(); // X√≥a preview sau khi l∆∞u
            updateDashboard();
            renderTable();
            
            // Trigger storage event for other tabs
            console.log('Admin: Dispatching storage event for', files.length, 'files');
            window.dispatchEvent(new StorageEvent('storage', {
                key: DB_FILES,
                newValue: JSON.stringify(files)
            }));
            
            // Also trigger custom event for same tab
            console.log('Admin: Dispatching custom storage event');
            window.dispatchEvent(new CustomEvent('storage-custom', {
                detail: { key: DB_FILES, data: files }
            }));
            
            // T·ª± ƒë·ªông chuy·ªÉn v·ªÅ trang ch·ªß sau 1.2 gi√¢y ƒë·ªÉ xem k·∫øt qu·∫£
            setTimeout(() => {
                showToast('File ƒë√£ ƒë∆∞·ª£c ƒëƒÉng th√†nh c√¥ng! ƒêang chuy·ªÉn v·ªÅ trang ch·ªß...', 'success');
                window.location.href = 'index.html';
            }, 1200);
        }

        function renderTable() {
            const files = JSON.parse(localStorage.getItem(DB_FILES)) || [];
            const tbody = document.getElementById('fileTableBody');
            
            if (!tbody) return;
            
            tbody.innerHTML = files.map(f => `
                <tr>
                    <td><img src="${f.image || 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNTAiIGhlaWdodD0iNTAiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHJlY3Qgd2lkdGg9IjUwIiBoZWlnaHQ9IjUwIiBmaWxsPSIjNkM3NUQiLz48dGV4dCB4PSI1MCUiIHk9IjUwJSIgZm9udC1mYW1pbHk9IkFyaWFsIiBmb250LXNpemU9IjEwIiBmaWxsPSJ3aGl0ZSIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZHk9Ii4zZW0iPk5vIEltZzwvdGV4dD48L3N2Zz4='}" class="thumb-img" onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNTAiIGhlaWdodD0iNTAiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHJlY3Qgd2lkdGg9IjUwIiBoZWlnaHQ9IjUwIiBmaWxsPSIjNkM3NUQiLz48dGV4dCB4PSI1MCUiIHk9IjUwJSIgZm9udC1mYW1pbHk9IkFyaWFsIiBmb250LXNpemU9IjEwIiBmaWxsPSJ3aGl0ZSIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZHk9Ii4zZW0iPk5vIEltZzwvdGV4dD48L3N2Zz4='"></td>
                    <td><strong>${f.name}</strong></td>
                    <td><span style="background: var(--primary-color); color: white; padding: 2px 8px; border-radius: 3px; font-size: 0.8rem;">${f.category}</span></td>
                    <td>${f.size}</td>
                    <td><i class="fa-solid fa-eye"></i> ${f.viewCount || 0}</td>
                    <td><i class="fa-solid fa-download"></i> ${f.downloads}</td>
                    <td style="color: #aaa; font-size: 0.9rem;">${f.link.substring(0, 30)}...</td>
                    <td>
                        <button class="btn-edit" onclick="editFile('${f.id}')" style="background: var(--secondary-color); color: white; border: none; padding: 5px 10px; border-radius: 5px; cursor: pointer; margin-right: 5px;">
                            <i class="fa-solid fa-edit"></i> S·ª≠a
                        </button>
                        <button class="btn-delete" onclick="deleteFile('${f.id}')">X√≥a</button>
                    </td>
                </tr>
            `).join('');
        }

        function deleteFile(id) {
            if(confirm('X√≥a file n√†y?')) {
                let files = JSON.parse(localStorage.getItem(DB_FILES)) || [];
                files = files.filter(f => f.id !== id);
                localStorage.setItem(DB_FILES, JSON.stringify(files));
                renderTable();
                showToast('ƒê√£ x√≥a file!', 'warning');
            }
        }

        function showToast(message, type = 'info', duration = 3000) {
            let container = document.getElementById('toastContainer');
            if (!container) {
                container = document.createElement('div');
                container.className = 'toast-container';
                container.id = 'toastContainer';
                document.body.appendChild(container);
            }

            const toast = document.createElement('div');
            toast.className = `toast toast-${type}`;
            toast.style.setProperty('--toast-duration', `${duration}ms`);

            const icons = {
                success: 'fa-solid fa-check-circle',
                error: 'fa-solid fa-exclamation-circle',
                warning: 'fa-solid fa-exclamation-triangle',
                info: 'fa-solid fa-info-circle'
            };

            toast.innerHTML = `
                <div class="toast-content">
                    <i class="${icons[type] || icons.info}"></i>
                    <span class="toast-message">${message}</span>
                    <button class="toast-close" type="button">
                        <i class="fa-solid fa-times"></i>
                    </button>
                </div>
                <div class="toast-progress"></div>
            `;

            container.appendChild(toast);

            setTimeout(() => {
                toast.classList.add('toast-show');
            }, 10);

            const closeBtn = toast.querySelector('.toast-close');
            if (closeBtn) {
                closeBtn.addEventListener('click', () => {
                    toast.classList.add('toast-hide');
                    setTimeout(() => {
                        if (toast.parentNode) toast.remove();
                    }, 300);
                });
            }

            setTimeout(() => {
                toast.classList.add('toast-hide');
                setTimeout(() => {
                    if (toast.parentNode) toast.remove();
                }, 300);
            }, duration);
        }

        function updateDashboard() {
            const files = JSON.parse(localStorage.getItem(DB_FILES)) || [];
            
            // T·ªïng quan
            document.getElementById('totalFiles').textContent = files.length;
            document.getElementById('totalDownloads').textContent = files.reduce((sum, f) => sum + (f.downloads || 0), 0);
            document.getElementById('totalViews').textContent = files.reduce((sum, f) => sum + (f.viewCount || 0), 0);
            
            // T√≠nh k√≠ch th∆∞·ªõc trung b√¨nh
            const avgSize = files.length > 0 ? 
                files.reduce((sum, f) => {
                    const size = parseFloat(f.size) || 0;
                    return sum + size;
                }, 0) / files.length : 0;
            document.getElementById('avgSize').textContent = avgSize.toFixed(1) + ' MB';
            
            // Th·ªëng k√™ theo danh m·ª•c
            const categories = {
                'game-pc': { name: 'Game PC', count: 0, downloads: 0 },
                'game-mobile': { name: 'Game Mobile', count: 0, downloads: 0 },
                'game-mod': { name: 'Game Mods', count: 0, downloads: 0 },
                'soft-office': { name: 'Software Office', count: 0, downloads: 0 },
                'soft-design': { name: 'Software Design', count: 0, downloads: 0 },
                'soft-dev': { name: 'Software Dev', count: 0, downloads: 0 },
                'doc-education': { name: 'Documents Education', count: 0, downloads: 0 },
                'doc-ebook': { name: 'Documents Ebook', count: 0, downloads: 0 },
                'tools-system': { name: 'Tools System', count: 0, downloads: 0 },
                'tools-security': { name: 'Tools Security', count: 0, downloads: 0 }
            };
            
            files.forEach(file => {
                if (categories[file.category]) {
                    categories[file.category].count++;
                    categories[file.category].downloads += file.downloads || 0;
                }
            });
            
            // C·∫≠p nh·∫≠t th·ªëng k√™ Game
            const gameCategories = ['game-pc', 'game-mobile', 'game-mod'];
            document.getElementById('gamePcCount').textContent = 
                gameCategories.reduce((sum, cat) => sum + categories[cat].count, 0);
            document.getElementById('gamePcDownloads').textContent = 
                gameCategories.reduce((sum, cat) => sum + categories[cat].downloads, 0);
            
            // C·∫≠p nh·∫≠t th·ªëng k√™ Software
            const softwareCategories = ['soft-office', 'soft-design', 'soft-dev'];
            document.getElementById('softwareCount').textContent = 
                softwareCategories.reduce((sum, cat) => sum + categories[cat].count, 0);
            document.getElementById('softwareDownloads').textContent = 
                softwareCategories.reduce((sum, cat) => sum + categories[cat].downloads, 0);
            
            // C·∫≠p nh·∫≠t th·ªëng k√™ Documents
            const documentCategories = ['doc-education', 'doc-ebook'];
            document.getElementById('documentsCount').textContent = 
                documentCategories.reduce((sum, cat) => sum + categories[cat].count, 0);
            document.getElementById('documentsDownloads').textContent = 
                documentCategories.reduce((sum, cat) => sum + categories[cat].downloads, 0);
            
            // C·∫≠p nh·∫≠t th·ªëng k√™ Tools
            const toolCategories = ['tools-system', 'tools-security'];
            document.getElementById('toolsCount').textContent = 
                toolCategories.reduce((sum, cat) => sum + categories[cat].count, 0);
            document.getElementById('toolsDownloads').textContent = 
                toolCategories.reduce((sum, cat) => sum + categories[cat].downloads, 0);
        }

        // Quick Actions Functions
        function exportData() {
            const files = JSON.parse(localStorage.getItem(DB_FILES)) || [];
            const dataStr = JSON.stringify(files, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            
            const exportFileDefaultName = `mint_hub_backup_${new Date().toISOString().slice(0,10)}.json`;
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
            
            showToast('ƒê√£ xu·∫•t d·ªØ li·ªáu th√†nh c√¥ng!', 'success');
        }

        function importData() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            
            input.onchange = e => {
                const file = e.target.files[0];
                const reader = new FileReader();
                
                reader.onload = event => {
                    try {
                        const data = JSON.parse(event.target.result);
                        if (Array.isArray(data)) {
                            localStorage.setItem(DB_FILES, JSON.stringify(data));
                            updateDashboard();
                            renderTable();
                            showToast('ƒê√£ nh·∫≠p d·ªØ li·ªáu th√†nh c√¥ng!', 'success');
                        } else {
                            showToast('File kh√¥ng h·ª£p l·ªá!', 'error');
                        }
                    } catch (error) {
                        showToast('L·ªói ƒë·ªçc file!', 'error');
                    }
                };
                
                reader.readAsText(file);
            };
            
            input.click();
        }

        function clearAllData() {
            if (confirm('‚ö†Ô∏è C·∫¢NH B√ÅO: X√≥a T·∫§T C·∫¢ d·ªØ li·ªáu? H√†nh ƒë·ªông n√†y kh√¥ng th·ªÉ ho√†n t√°c!')) {
                if (confirm('B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a t·∫•t c·∫£ files?')) {
                    localStorage.setItem(DB_FILES, JSON.stringify([]));
                    updateDashboard();
                    renderTable();
                    showToast('ƒê√£ x√≥a t·∫•t c·∫£ d·ªØ li·ªáu!', 'warning');
                }
            }
        }

        function resetStats() {
            if (confirm('Reset t·∫•t c·∫£ th·ªëng k√™ (l∆∞·ª£t xem, l∆∞·ª£t t·∫£i) v·ªÅ 0?')) {
                const files = JSON.parse(localStorage.getItem(DB_FILES)) || [];
                files.forEach(file => {
                    file.downloads = 0;
                    file.viewCount = 0;
                });
                localStorage.setItem(DB_FILES, JSON.stringify(files));
                updateDashboard();
                renderTable();
                showToast('ƒê√£ reset th·ªëng k√™!', 'info');
            }
        }

        function backupData() {
            const files = JSON.parse(localStorage.getItem(DB_FILES)) || [];
            const backup = {
                timestamp: new Date().toISOString(),
                version: '1.0',
                data: files
            };
            
            const dataStr = JSON.stringify(backup, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            
            const exportFileDefaultName = `mint_hub_full_backup_${new Date().toISOString().slice(0,10)}.json`;
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
            
            showToast('ƒê√£ t·∫°o backup th√†nh c√¥ng!', 'success');
        }

        // Image Upload Functions
        function handleImageUpload(event) {
            const file = event.target.files[0];
            if (file) {
                // Ki·ªÉm tra file c√≥ ph·∫£i l√† ·∫£nh kh√¥ng
                if (!file.type.startsWith('image/')) {
                    showToast('Vui l√≤ng ch·ªçn file ·∫£nh!', 'error');
                    return;
                }

                // Ki·ªÉm tra k√≠ch th∆∞·ªõc file (max 5MB)
                if (file.size > 5 * 1024 * 1024) {
                    showToast('K√≠ch th∆∞·ªõc ·∫£nh kh√¥ng ƒë∆∞·ª£c v∆∞·ª£t qu√° 5MB!', 'error');
                    return;
                }

                const reader = new FileReader();
                reader.onload = function(e) {
                    // Hi·ªÉn th·ªã preview
                    const preview = document.getElementById('imagePreview');
                    const previewImg = document.getElementById('previewImg');
                    
                    previewImg.src = e.target.result;
                    preview.style.display = 'block';
                    
                    // L∆∞u base64 v√†o input text
                    document.getElementById('fileImage').value = e.target.result;
                    
                    showToast('ƒê√£ t·∫£i ·∫£nh l√™n th√†nh c√¥ng!', 'success');
                };
                reader.readAsDataURL(file);
            }
        }

        function removeImagePreview() {
            const preview = document.getElementById('imagePreview');
            const previewImg = document.getElementById('previewImg');
            const imageInput = document.getElementById('fileImage');
            const fileInput = document.getElementById('imageUpload');
            
            preview.style.display = 'none';
            previewImg.src = '';
            imageInput.value = '';
            fileInput.value = '';
        }

        // Auto-update image preview khi nh·∫≠p link
        document.addEventListener('DOMContentLoaded', function() {
            const imageInput = document.getElementById('fileImage');
            if (imageInput) {
                imageInput.addEventListener('input', function() {
                    const url = this.value.trim();
                    const preview = document.getElementById('imagePreview');
                    const previewImg = document.getElementById('previewImg');
                    
                    if (url) {
                        // Ki·ªÉm tra xem c√≥ ph·∫£i URL h·ª£p l·ªá kh√¥ng
                        try {
                            new URL(url);
                            previewImg.src = url;
                            preview.style.display = 'block';
                        } catch (e) {
                            // Kh√¥ng ph·∫£i URL h·ª£p l·ªá, ·∫©n preview
                            preview.style.display = 'none';
                        }
                    } else {
                        preview.style.display = 'none';
                    }
                });
            }
        });

        // Edit File Functions
        function editFile(id) {
            const files = JSON.parse(localStorage.getItem(DB_FILES)) || [];
            const file = files.find(f => f.id === id);
            
            if (file) {
                // Fill edit form with file data
                document.getElementById('editFileId').value = file.id;
                document.getElementById('editFileName').value = file.name;
                document.getElementById('editFileCategory').value = file.category;
                document.getElementById('editFileSize').value = file.size;
                document.getElementById('editFileDownloads').value = file.downloads || 0;
                document.getElementById('editFileViewCount').value = file.viewCount || 0;
                document.getElementById('editFileLink').value = file.link;
                document.getElementById('editFileDesc').value = file.desc || '';
                document.getElementById('editFileImage').value = file.image || '';
                
                // Show image preview if exists
                if (file.image) {
                    const preview = document.getElementById('editImagePreview');
                    const previewImg = document.getElementById('editPreviewImg');
                    previewImg.src = file.image;
                    preview.style.display = 'block';
                }
                
                // Show modal
                document.getElementById('editModal').style.display = 'flex';
            }
        }

        function closeEditModal() {
            document.getElementById('editModal').style.display = 'none';
            // Clear form
            document.getElementById('editFileForm').reset();
            removeEditImagePreview();
        }

        function handleEditFile(e) {
            e.preventDefault();
            const files = JSON.parse(localStorage.getItem(DB_FILES)) || [];
            const fileId = document.getElementById('editFileId').value;
            
            // Find and update file
            const fileIndex = files.findIndex(f => f.id === fileId);
            if (fileIndex !== -1) {
                files[fileIndex] = {
                    id: fileId,
                    name: document.getElementById('editFileName').value,
                    category: document.getElementById('editFileCategory').value,
                    size: document.getElementById('editFileSize').value,
                    downloads: parseInt(document.getElementById('editFileDownloads').value) || 0,
                    viewCount: parseInt(document.getElementById('editFileViewCount').value) || 0,
                    link: document.getElementById('editFileLink').value,
                    desc: document.getElementById('editFileDesc').value,
                    image: document.getElementById('editFileImage').value || 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzAwIiBoZWlnaHQ9IjIwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMzAwIiBoZWlnaHQ9IjIwMCIgZmlsbD0iIzZDNzVEIi8+PHRleHQgeD0iNTAlIiB5PSI1MCUiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSIxOCIgZmlsbD0id2hpdGUiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGR5PSIuM2VtIj5ObyBJbWFnZTwvdGV4dD48L3N2Zz4='
                };
                
                localStorage.setItem(DB_FILES, JSON.stringify(files));
                
                showToast('ƒê√£ c·∫≠p nh·∫≠t file! D·ªØ li·ªáu s·∫Ω t·ª± ƒë·ªông ƒë·ªìng b·ªô v·ªõi trang ch·ªß.', 'success');
                closeEditModal();
                updateDashboard();
                renderTable();
                
                // Trigger storage event for other tabs
                window.dispatchEvent(new StorageEvent('storage', {
                    key: DB_FILES,
                    newValue: JSON.stringify(files)
                }));
                
                // Also trigger custom event for same tab
                window.dispatchEvent(new CustomEvent('storage-custom', {
                    detail: { key: DB_FILES, data: files }
                }));
            }
        }

        // Edit Image Upload Functions
        function handleEditImageUpload(event) {
            const file = event.target.files[0];
            if (file) {
                // Ki·ªÉm tra file c√≥ ph·∫£i l√† ·∫£nh kh√¥ng
                if (!file.type.startsWith('image/')) {
                    showToast('Vui l√≤ng ch·ªçn file ·∫£nh!', 'error');
                    return;
                }

                // Ki·ªÉm tra k√≠ch th∆∞·ªõc file (max 5MB)
                if (file.size > 5 * 1024 * 1024) {
                    showToast('K√≠ch th∆∞·ªõc ·∫£nh kh√¥ng ƒë∆∞·ª£c v∆∞·ª£t qu√° 5MB!', 'error');
                    return;
                }

                const reader = new FileReader();
                reader.onload = function(e) {
                    // Hi·ªÉn th·ªã preview
                    const preview = document.getElementById('editImagePreview');
                    const previewImg = document.getElementById('editPreviewImg');
                    
                    previewImg.src = e.target.result;
                    preview.style.display = 'block';
                    
                    // L∆∞u base64 v√†o input text
                    document.getElementById('editFileImage').value = e.target.result;
                    
                    showToast('ƒê√£ t·∫£i ·∫£nh l√™n th√†nh c√¥ng!', 'success');
                };
                reader.readAsDataURL(file);
            }
        }

        function removeEditImagePreview() {
            const preview = document.getElementById('editImagePreview');
            const previewImg = document.getElementById('editPreviewImg');
            const imageInput = document.getElementById('editFileImage');
            const fileInput = document.getElementById('editImageUpload');
            
            preview.style.display = 'none';
            previewImg.src = '';
            imageInput.value = '';
            fileInput.value = '';
        }

        // Auto-update edit image preview khi nh·∫≠p link
        document.addEventListener('DOMContentLoaded', function() {
            const editImageInput = document.getElementById('editFileImage');
            if (editImageInput) {
                editImageInput.addEventListener('input', function() {
                    const url = this.value.trim();
                    const preview = document.getElementById('editImagePreview');
                    const previewImg = document.getElementById('editPreviewImg');
                    
                    if (url) {
                        // Ki·ªÉm tra xem c√≥ ph·∫£i URL h·ª£p l·ªá kh√¥ng
                        try {
                            new URL(url);
                            previewImg.src = url;
                            preview.style.display = 'block';
                        } catch (e) {
                            // Kh√¥ng ph·∫£i URL h·ª£p l·ªá, ·∫©n preview
                            preview.style.display = 'none';
                        }
                    } else {
                        preview.style.display = 'none';
                    }
                });
            }
        });

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            checkAdminAuth();
        });
    </script>
</body>
</html>